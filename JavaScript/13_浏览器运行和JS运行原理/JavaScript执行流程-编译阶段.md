# 写出v8引擎执行代码的大致流程

浏览器内核遇到script标签后，从服务器下载JavaScript文件，再交给浏览器内核，然后交给v8引擎进行处理

- 首先v8引擎会将JavaScript代码转换为stream
- 然后进行词法分析
  - 标记一个个token
- 语法分析
  - 将拿到的tokens解析为AST
- 然后ignition会将AST转换成bytecode
  - 如果函数只调用一次，直接执行bytecode
  - 同时会收集turbofan优化所需要的信息（函数参数类型的信息)
- turbofan可以将字节码编译成cpu可以直接执行的机器码
  - 如果一个函数被多次调用，会被标记成热点函数，那么就会经过TurboFan转换成优化的机器码，提高代码的执行性能
  - 机器码实际上也会被还原为ByteCode，这是因为如果后续执行函数的过程中，类型发生了变化（比如sum函数原来执行的是number类型，后来执行变成了string类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码