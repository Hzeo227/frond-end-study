# 写出v8引擎执行代码的大致流程

也就是JavaScript执行的编译阶段

分为3部分

1. js引擎将代码转换为字节流，进行词法分析
   1. 分解成一个个有意义的词法单元（用token 标记）
2. 进行语法分析
   1. 将得到的tokens分析成一个抽象语法树
3. 将AST通过ignition解释器转换成字节码，交由CPU执行，同时收集优化所需要的信息（函数参数的类型，函数被调用的次数）
   1. 将可优化的信息（函数被多次执行），通过TurBoFan编译器，编译成更好用的机器码交由CPU执行
   2. 如果后续执行代码时，代码的参数类型发生改变，则逆优化为字节码，让CPU执行







浏览器内核遇到script标签后，从服务器下载JavaScript文件，再交给浏览器内核，然后交给v8引擎进行处理

- 首先v8引擎会将JavaScript代码转换为stream
- 然后进行词法分析
  - 标记一个个token
- 语法分析
  - 将拿到的tokens解析为AST
- 然后ignition会将AST转换成bytecode
  - 如果函数只调用一次，直接执行bytecode
  - 同时会收集turbofan优化所需要的信息（函数参数类型的信息)
- turbofan可以将字节码编译成cpu可以直接执行的机器码
  - 如果一个函数被多次调用，会被标记成热点函数，那么就会经过TurboFan转换成优化的机器码，提高代码的执行性能
  - 机器码实际上也会被还原为ByteCode，这是因为如果后续执行函数的过程中，类型发生了变化（比如sum函数原来执行的是number类型，后来执行变成了string类型），之前优化的机器码并不能正确的处理运算，就会逆向的转换成字节码